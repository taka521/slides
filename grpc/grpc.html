<DOCTYPE html>
    <html>

    <head>
        <title>gRPC</title>
        <meta charset="utf-8">
        <style>
            @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
            @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
            @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

            body {
                font-family: 'Droid Serif';
            }

            h1,
            h2,
            h3 {
                text-align: center;
                color: #006cb4;
                font-weight: 700;
            }

            .remark-slide-content h1 {
                font-size: 3em;
            }

            .remark-slide-content h2 {
                font-size: 2em;
            }

            .remark-slide-content h3 {
                font-size: 1.4em;
            }

            .footnote {
                position: absolute;
                bottom: 1em;
            }

            /* ãƒªãƒ³ã‚¯ */
            a,
            a>code,
            p a {
                color: #ff1a75;
                text-decoration: none;
                font-size: 100%;
            }

            /* ã‚³ãƒ¼ãƒ‰ */
            code {
                font-family: 'Ubuntu Mono';
                border-radius: 5px;
                -web-border-radius: 5px;
                font-size: 90%
            }

            .remark-code,
            .remark-inline-code {
                font-size: 85%;
                color: #660000;
                font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
                background-color: #eeeeee;
            }

            .remark-code-line-highlighted {
                background-color: #eeeeee;
            }

            .pull-left {
                float: left;
                width: 47%;
            }

            .pull-right {
                float: right;
                width: 47%;
            }

            .pull-right~p {
                clear: both;
            }

            /* ã‚¿ã‚¤ãƒˆãƒ«ãƒšãƒ¼ã‚¸ */
            .inverse {
                background: #006cb4;
                color: #CCC;
            }

            .inverse h1,
            .inverse h2 {
                color: #f3f3f3;
                line-height: 1em;
            }

            /* å·¦å³äºŒæ®µè¡¨ç¤º */
            .left-column {
                width: 48%;
                float: left;
            }

            .right-column {
                width: 48%;
                float: right;
            }

            p,
            li {
                font-size: 120%;
            }

            /* ãƒªã‚¹ãƒˆå†…ã®ãƒªã‚¹ãƒˆã¯æ–‡å­—ã‚’å°ã•ã */
            ul li ul li,
            ol li ul li {
                font-size: 90%;
            }
        </style>
    </head>

    <body>
        <textarea id="source">
class: center, middle
# gRPC

2019/07/25

---
class: middle

## Agenda

* What's gRPC ?
* Use case

---
class: middle, center

<img src="https://github.com/taka521/slides/blob/gh-pages/grpc/img/2019-06-27_15h50_48.jpg?raw=true" width="100%"/>

---
class: middle

## What's gRPC ?

GoogleãŒOSSã¨ã—ã¦æä¾›ã—ã¦ã„ã‚‹ã€**RPC(Remote Procedure Call)**ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚  
`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã«IFã‚’å®šç¾©ã™ã‚‹ã¨ã€ã‚µãƒ¼ãƒã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã€‚  
ğŸ‘‰ `ProtocolBuffers` ã¨ã„ã†ã‚‚ã®ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã€‚(ã“ã‚Œã‚‚GoogleãŒé–‹ç™ºã—ã¦ã„ã‚‹)

* [https://grpc.io/](https://grpc.io/)
* [https://developers.google.com/protocol-buffers/](https://developers.google.com/protocol-buffers/)

å¯¾å¿œè¨€èªã¯ C++, C#, Dart, Go, Java, Node.js, PHP, Python, Rubyã€‚


---
class: middle

## What's gRPC ?


RPCã£ã¦ï¼Ÿ

> ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰åˆ¥ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ï¼ˆé€šå¸¸ã€å…±æœ‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®åˆ¥ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ä¸Šï¼‰ã«ã‚ã‚‹ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³ã‚„æ‰‹ç¶šãã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹æŠ€è¡“ã€‚
> ãƒ—ãƒ­ã‚°ãƒ©ãƒã¯ãƒ­ãƒ¼ã‚«ãƒ«ãªã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³å‘¼ã³å‡ºã—ã¨åŸºæœ¬çš„ã«åŒã˜ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ¢ãƒ¼ãƒˆå‘¼ã³å‡ºã—ã«ã¤ã„ã¦ã‚‚è¡Œã†ã€‚  
> 
> https://ja.wikipedia.org/wiki/é éš”æ‰‹ç¶šãå‘¼å‡ºã—


---
class: middle

## What's gRPC ?

ProtocolBuffersã£ã¦ï¼Ÿ

> ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©è¨€èª (IDL) ã§æ§‹é€ ã‚’å®šç¾©ã™ã‚‹é€šä¿¡ã‚„æ°¸ç¶šåŒ–ã§ã®åˆ©ç”¨ã‚’ç›®çš„ã¨ã—ãŸã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ  
> XMLã¨ã®æ¯”è¼ƒã§ã€3ã€œ10å€å°ã•ãã€20ã€œ100å€é«˜é€Ÿã§ã‚ã‚‹  
> XMLã§ã¯69ãƒã‚¤ãƒˆä»¥ä¸Šã®ç‰©ãŒ Protocol Buffersã§ã¯28ãƒã‚¤ãƒˆã§ã‚ã‚Šã€XMLã®ãƒ‘ãƒ¼ã‚¹ã¯5ã€œ10ãƒã‚¤ã‚¯ãƒ­ç§’ã‚‚å¿…è¦ã ãŒã€Protocol Buffersã®ãƒ‘ãƒ¼ã‚¹ã¯0.1ã€œ0.2 ãƒã‚¤ã‚¯ãƒ­ç§’ã§å®Œäº†ã™ã‚‹ã¨ã—ã¦ã„ã‚‹ã€‚
> 
> https://ja.wikipedia.org/wiki/Protocol_Buffers

---
class: middle

## What's gRPC ?

hello_world.proto

```protocol-buffers
service HelloWorldService {
    rpc HelloWorld (HelloRequest) return (HelloResponse) {}
}

message HelloRequest {
    int64 id = 1;
    string name = 2;
    Gender gender = 3;

    enum Gender {
        MAN = 0;
        WOMAN = 1;
    }
}

message HelloResponse {
    int32 code = 1
    string message = 2;
}
```

---
class: middle

## What's gRPC ?

å…ˆç¨‹ã® `hello_world.proto` ã‚’Javaã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€

* `HelloWorldServiceGrpc.java`
* `HelloRequest.java`
* `HelloResponse.java`

ã¨ã„ã£ãŸã‚¯ãƒ©ã‚¹ãŒä½œæˆã•ã‚Œã‚‹ã€‚  
ğŸ‘‰ Javaã®å ´åˆã ã¨ã€mavenã‚„gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ãƒ“ãƒ«ãƒ‰æ™‚ã«gRPCã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’ãƒ•ãƒƒã‚¯ã•ã›ã‚‹ã€‚

---
class: middle

## What's gRPC ?

ä½œæˆã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã‚’å…ƒã«ã€å®Ÿéš›ã«å®Ÿè£…ã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã€‚

**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**

```kotlin
// æ¥ç¶šå…ˆæƒ…å ±
val channel = ManagedChannelBuilder.forAddress("localhost", 8080).usePlaintext().build()

// ã‚¹ã‚¿ãƒ–ã¨å‘¼ã°ã‚Œã‚‹gRPCã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
val blockingStub = HelloWorldServiceGrpc.newBlockingStub(channel)

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ã®ä½œæˆ
val request = HelloRequest.newBuilder().apply {
    id = 100L
    name = "Bob"
    gender = HelloRequest.Gender.MAN
}.build()

// å‘¼å‡º
blockingStub.helloWorld(request)
```

---
class: middle

## What's gRPC ?

**ã‚µãƒ¼ãƒ**

```HelloWorldService.kt
class HelloWorldService : HelloWorldServiceGrpc.HelloWorldServiceImplBase() {

    override fun helloWorld(request: HelloRequest, responseObserver: StreamObserver<HelloResponse>) {
        // æœ¬æ¥ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚´ãƒ‹ãƒ§ã‚´ãƒ‹ãƒ§ã—ã¦ã€onNextã«ãƒ‡ãƒ¼ã‚¿ã‚’æµã™
        responseObserver.onNext(
            HelloResponse.newBuilder().apply {
                code = 200
                message = "Hello World!"
            }.build()
        )
        responseObserver.onCompleted()
    }
}
```

---
class: middle

## What's gRPC ?

ãªã«ãŒå¬‰ã—ã„ã‹

* `.proto`ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆIFå®šç¾©æ›¸ï¼‰ã«ãªã‚‹ã€‚
* å¯èª­æ€§ãŒé«˜ã„(ç›´æ„Ÿçš„ãª)ãŸã‚ã€ãƒ¡ãƒ³ãƒ†ãŒæ¥½ã€‚
  * XMLã‚„JSON schemaã¯èª­ã¿ã«ãã„ã—ã€ãƒ¡ãƒ³ãƒ†ã‚‚é¢å€’ãªã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ã‚‹ã€‚
* ã‚µãƒ¼ãƒã¯å¿…ãšã“ã®å®šç¾©ã«å¾“ã£ã¦ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã‚‹ã€‚
  * æœªå®Ÿè£…ã®å ´åˆã¯ã€å®Ÿè¡Œæ™‚ã«æœªå®Ÿè£…ã‚¨ãƒ©ãƒ¼ãŒåã‹ã‚Œã‚‹ã€‚
* HTTP2.0ã«å¯¾å¿œã—ã¦ã„ã‚‹ãŸã‚ã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆå¤šé‡é€ä¿¡ï¼‰ãŒåˆ©ç”¨ã§ãã‚‹ã€‚
  * ã¾ãŸã€HTTP2.0ã¯é«˜é€Ÿ

---
class: middle

## Agenda

* ~~What's gRPC ?~~
* **Use case**

---
class: middle, center

# Use case

---
class: middle

## Use case

* ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹
* ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª

æ—¥æœ¬ã ã¨Cookpadã‚„freeeã€ãƒ¡ãƒ«ã‚«ãƒªã€LINEãªã©ã§å°å…¥äº‹ä¾‹ã‚ã‚Šã€‚  
ã©ã®ä¼šç¤¾ã‚‚MSAã«å¯¾ã—ã¦ã€gRPCã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã‚ˆã†ã€‚

---
class: middle

## ãã®ä»–

* Springã«ã‚‚çµ„ã¿è¾¼ã‚ã‚‹ã¿ãŸã„ã ã‘ã©ã€æœªæ¤œè¨¼
* ã€Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã¯RESTã§å‘¼ã³å‡ºã—ãŸã„ï¼ã€å ´åˆã«ã¯ã€`grpc-gateway` ã¨ã„ã†ã‚‚ã®ã§å®Ÿç¾ã§ãã‚‹ã‚‰ã—ã„ã€‚
  * Client to grpc-gateway => REST
  + grpc-gateway to Server => gRPC


        </textarea>
        <script src="https://remarkjs.com/downloads/remark-latest.min.js" type="text/javascript"></script>
        <script type="text/javascript">
            var slideshow = remark.create({
                ratio: '4:3'
            });
        </script>
    </body>

    </html>
